      if (result.success && result.data) {
        const content = result.data.choices[0]?.message?.content;
        if (content) {
          // Clean up code blocks if present
          const jsonStr = content.replace(/```json/g, '').replace(/```/g, '');
          
          const crops = JSON.parse(jsonStr) as MarketItem[];
          
          return crops.map((crop: MarketItem) => ({
            ...crop,
            current: Math.round(crop.avg + (Math.random() * 100 - 50))
          }));
        }
      }
      // Fallback if AI returns success=false or no content
      console.log("AI returned no data, using fallback.");
      return fallbackCrops;
    } catch (error) {
      console.error("Error fetching market prices:", error);
      return fallbackCrops;
    }