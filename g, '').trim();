          const crops = JSON.parse(jsonStr) as MarketItem[];
          
          return crops.map((crop: MarketItem) => ({
            ...crop,
            current: Math.round(crop.avg + (Math.random() * 100 - 50))
          }));
        }
      }
      
      // If no content or success is false, throw to use fallback
      throw new Error("AI response invalid or empty");
      
    } catch (error) {
      console.error("Error fetching market prices, using fallback:", error);
      
      // Return fallback data with slight randomization for "live" feel
      return fallbackCrops.map((crop: MarketItem) => ({
        ...crop,
        current: Math.round(crop.avg + (Math.random() * 100 - 50))
      }));
    }
  },
});